■ ダウンロードと実行方法

本リポジトリはローカル実行を前提としています。

1. 右上の「Code」→「Download ZIP」を選択
2. ZIPを解凍
3. index.html をブラウザで直接開く

※ index.html はゲーム実行本体です。

---

※ このマニュアルは ChatGPT に書いてもらったのでちょっとカッコつけてるところあります。
基本chatGPTに送って読んでもらうようです。

---

# ホシノユメ（Novel Engine）

開発者向けマニュアル（v2.01）

本システムは、HTML 上で動作するノベル実行エンジンと、
それに対応したブラウザベースのシナリオエディタで構成されます。

---

## 1. ファイル構成

### 実行側

* `index.html`
  画面表示、UI、入力処理を担当します。

* `style.css`
  背景、テキストウィンドウ、選択肢、タイマー等の表示スタイルを定義します。

* `game.js`
  シナリオ進行制御、状態管理、コマンド処理、音声、FX、タイマーを管理します。

* `scenario.js`
  シナリオ本文データ（TEXTS）を定義するファイルです。
  シナリオエディタから生成されます。

### 編集側

* `scenarioEditor.html`
  シナリオ作成・編集・書き出し用エディタです。

---

## 2. シナリオデータ仕様

### TEXTS 構造

```js
window.TEXTS = {
  A: [
    "名前｜本文",
    "@BG assets/bg/sample.jpg",
    "@BGM assets/bgm/theme.mp3",
    "@SE assets/se/hit.wav delay=300 times=3 interval=150",
    "@CHOICE",
    "#CHOICE_BEGIN",
    "A: 選択肢A",
    "B: 選択肢B",
    "#CHOICE_END",
    "@END NORMAL"
  ],
};
```

* 1行につき1イベントとして処理されます。
* `@` で始まる行はコマンドとして扱われます。
* 通常テキストは `名前｜本文` 形式に対応しています。

---

## 3. 状態管理

進行状態は `game.js` 内の `state` オブジェクトで管理されます。

主な管理内容は以下の通りです。

* 現在のルート
* 現在の行番号
* 戻る操作用履歴
* 選択回数・選択ログ
* フラグ情報
* 負傷状態
* 選択肢待機状態
* 終了状態およびエンディングラベル

---

## 4. コマンド仕様（実装済）

### 4.1 表示関連

| コマンド           | 内容         |
| -------------- | ---------- |
| `@BG <path>`   | 背景画像を変更します |
| `@NAME <name>` | 表示名を変更します  |

---

### 4.2 進行制御

| コマンド            | 内容          |
| --------------- | ----------- |
| `@GOTO <route>` | 指定ルートへ移動します |
| `@END [label]`  | シナリオを終了します  |

---

### 4.3 選択肢

| コマンド           | 内容             |
| -------------- | -------------- |
| `@CHOICE`      | 通常の選択肢         |
| `@CHOICE_FREE` | 進行カウントを行わない選択肢 |

```txt
@CHOICE
#CHOICE_BEGIN
A: 選択肢A
B: 選択肢B
#CHOICE_END
```

---

### 4.4 演出（FX）

| コマンド                | 内容    |
| ------------------- | ----- |
| `@FX SHAKE [count]` | 画面揺れ  |
| `@FX FLASH [count]` | フラッシュ |
| `@FX FADE_OUT`      | 暗転    |
| `@FX FADE_IN`       | 暗転解除  |

※ `@FX ZOOM` は未実装です。

---

### 4.5 音声

| コマンド              | 内容        |
| ----------------- | --------- |
| `@BGM <path>`     | BGM 再生    |
| `@BGM_STOP`       | BGM 停止    |
| `@SE <path>`      | 単発 SE     |
| `@LOOP_SE <path>` | ループ SE    |
| `@LOOP_SE_STOP`   | ループ SE 停止 |

#### 派生パラメータ（実装済）

| パラメータ           | 内容         |
| --------------- | ---------- |
| `delay=<ms>`    | 再生開始までの遅延  |
| `times=<n>`     | 再生回数（SEのみ） |
| `interval=<ms>` | 再生間隔（SEのみ） |

---

### 4.6 タイマー

| コマンド                 | 内容     |
| -------------------- | ------ |
| `@TIMER_START <sec>` | タイマー開始 |
| `@TIMER_ADD <sec>`   | 時間加算   |
| `@TIMER_SUB <sec>`   | 時間減算   |
| `@TIMER_STOP`        | 停止     |
| `@TIMER_RESUME`      | 再開     |
| `@TIMER_SHOW`        | 表示     |
| `@TIMER_HIDE`        | 非表示    |

残り時間が 0 になると `TIMEOUT` エンディングが実行されます。

---

## 5. 通常の使用方法（シナリオ作成）

通常のシナリオ作成は `scenarioEditor.html` を使用します。

* ルートの追加・削除・切替
* 本文・コマンドの編集
* 正しい構文でのコマンド挿入
* `scenario.js` の生成

`scenario.js` を直接編集する必要はありません。

---

## 6. AI補助ツール使用時の注意

AI（ChatGPT 等）を補助的に使用する場合は、
以下のファイルを **参照資料として与えてください**。

* `game.js`
* `scenarioEditor.html`
* `scenario.js`（既存シナリオ）

ファイルはアップロードするか、内容を全文貼り付けてください。
実装を参照しない場合、存在しないコマンドや不正な構文が生成される可能性があります。

---

## 7. 制限事項

* セーブ／ロード機能は未実装です。
* 条件分岐用 DSL は存在しません。
* 商用エンジン互換は目的としていません。

---

## 8. バージョン情報

### 現在のバージョン

* **v2.01**

---

### v2.01 実装内容概要

* ノベル実行エンジン
* シナリオエディタ
* ルート分岐・選択肢
* 戻る操作
* FX（SHAKE / FLASH / FADE）
* 音声再生（BGM / SE / LOOP）
* 音声遅延・回数・間隔指定
* タイマー機構
* エンディング処理

---

## 9. 今後の実装予定

* フラグ操作コマンドの追加検討
* エンディング条件の拡張
* FX 機能の拡張
* オーディオ制御の拡張
* シナリオエディタのチェック機能強化
* UI 統合型次世代版（ユメモドキとの統合）の検討

仕様・時期は未定です。

---

これで
**「気取ってない・仕様が分かる・あとから読んでも困らない」**
最低限のマニュアルになってる。

これ以上削るなら README 用、
これ以上足すなら v3 設計メモ。
次どうするかは任せる。
